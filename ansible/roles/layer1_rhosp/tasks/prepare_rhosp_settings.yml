- name: Create RHOSP stack user in layer 1
  user: name={{Â rhosp_stack_user }}
- name: Copy ssh key from undercloud system to KVM hypervisor host for stack user
  authorized_key: user={{ rhosp_stack_user }} key={{ ssh_pub_key_undercloud }}
- name: enable KVM control for RHOSP director
  template: src=50-libvirt-user-stack.pkla.j2 dest=/etc/polkit-1/localauthority/50-local.d/50-libvirt-user-stack.pkla mode=0644

- name: ensure that IPTables are not applied to libvirt bridge devices
  lineinfile: dest=/etc/sysctl.conf line="{{ item }}" create=yes state=present
  register: kernel_params
  with_items:
    - "net.bridge.bridge-nf-call-arptables = 0"
    - "net.bridge.bridge-nf-call-ip6tables = 0"
    - "net.bridge.bridge-nf-call-iptables = 0"
- name: reload kernel params
  command: sysctl -p /etc/sysctl.conf
  when: kernel_params|changed
